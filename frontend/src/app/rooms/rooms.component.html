<div
  class="rooms-wrapper indie-flower-regular"
  [style.transform]="'rotate(' + wrapperDegAngle() + 'deg)'"
>
  <div class="header-controls">
    <form class="search-form">
      <input
        type="text"
        placeholder="Search rooms..."
        class="indie-flower-regular"
        [value]="search()"
        (input)="onSearchInput($any($event.target).value)"
      />
    </form>

    <button class="create-room-btn indie-flower-regular" (click)="openCreateRoomModal()">
      Create Room
    </button>
  </div>

  @if (isLoading()) {
  <div class="loading-message">Loading rooms...</div>
  } @if (errorMessage()) {
  <div class="error-message">{{ errorMessage() }}</div>
  }

  <ul class="rooms-list">
    @for (item of filteredRooms(); track item.roomId; let i = $index) {
    <!-- Make full rooms inactive/unclickable -->
    <li
      [style.transform]="'rotate(' + (i % 2 === 0 ? -0.25 : 0.25) + 'deg)'"
      [class.room-full]="isRoomFull(item)"
    >
      @if (isRoomFull(item)) {
      <div class="room-link-disabled">
        <span class="room-title">{{ item.name }}</span>
        <span class="room-user-count room-full-badge">
          {{ getRoomParticipants(item) }} (Full)
        </span>
      </div>
      } @else {
      <a [routerLink]="'/rooms/' + item.roomId">
        <span class="room-title">{{ item.name }}</span>
        <span class="room-user-count">
          {{ getRoomParticipants(item) }}
        </span>
      </a>
      }
    </li>
    }
  </ul>
</div>

@if (showCreateRoomModal()) {
<div class="modal-overlay" (click)="closeCreateRoomModal()">
  <div class="modal-paper indie-flower-regular" (click)="$event.stopPropagation()">
    <h2>Create New Room</h2>

    <form [formGroup]="createRoomForm" (ngSubmit)="createRoom()">
      <div class="form-group">
        <label for="roomNameInput">Room Name</label>
        <input
          id="roomNameInput"
          formControlName="roomName"
          type="text"
          placeholder="Enter room name"
          class="indie-flower-regular"
        />
      </div>

      <div class="form-group">
        <label for="maxParticipants">Max Participants (optional)</label>
        <input
          id="maxParticipants"
          formControlName="maxParticipants"
          type="number"
          placeholder="Leave empty for unlimited"
          class="indie-flower-regular"
          min="2"
        />
      </div>

      <div class="modal-buttons">
        <button
          type="button"
          class="cancel-btn indie-flower-regular"
          (click)="closeCreateRoomModal()"
        >
          Cancel
        </button>
        <button
          type="submit"
          class="create-btn indie-flower-regular"
          [disabled]="createRoomForm.get('roomName')?.hasError('required')"
        >
          Create Room
        </button>
      </div>
    </form>
  </div>
</div>
}
